import{d as N,h as V,i as q,j as B,r as j,k as K,l as D,o as _,m as ee,a as i,n as E,q as m,t as w,u as l,x as O,T as te}from"./index.ffee394d.js";var ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII=";const se=["width","height"],ne=["width","height"],ie=["width","height"],oe=i("div",{class:"loading-gif_"},[i("span"),i("span"),i("span"),i("span"),i("span")],-1),le=[oe],ce={class:"auth-control_"},re={class:"range-text"},ue=i("div",null,null,-1),de=i("div",null,null,-1),he=i("div",null,null,-1),fe=[ue,de,he],ge=N({props:{canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},imgs:{type:Array,default:null},successText:{type:String,default:"\u9A8C\u8BC1\u901A\u8FC7\uFF01"},failText:{type:String,default:"\u9A8C\u8BC1\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"},sliderText:{type:String,default:"\u62D6\u52A8\u6ED1\u5757\u5B8C\u6210\u62FC\u56FE"}},emits:["success","fail","close"],setup(c,{emit:Y}){const n=c;V(()=>{document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",S,!1),document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",S,!1),n.show&&(document.body.classList.add("vue-puzzle-overflow"),C())}),q(()=>{e.timer1&&clearTimeout(e.timer1),document.removeEventListener("mousemove",x,!1),document.removeEventListener("mouseup",S,!1),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",S,!1)});const W=B(),H=B(),z=B(),F=B(),e=j({mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});K(()=>n.show,s=>{s?(document.body.classList.add("vue-puzzle-overflow"),C()):(e.isSubmting=!1,e.isSuccess=!1,e.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))});const X=D(()=>{const s=e.startWidth+e.newX-e.startX;return s<d.value?d.value:s>n.canvasWidth?n.canvasWidth:s}),r=D(()=>Math.round(Math.max(Math.min(n.puzzleScale,2),.2)*52.5+6)),d=D(()=>Math.max(Math.min(Math.round(n.sliderSize),Math.round(n.canvasWidth*.5)),10)),P=()=>{e.mouseDown||(e.timer1&&clearTimeout(e.timer1),Y("close"))},I=()=>{e.closeDown=!0},k=()=>{e.closeDown&&P(),e.closeDown=!1},R=s=>{var t,u;e.isCanSlide&&(e.mouseDown=!0,e.startWidth=(u=(t=W.value)==null?void 0:t.clientWidth)!=null?u:0,e.newX=s.clientX||s.changedTouches[0].clientX,e.startX=s.clientX||s.changedTouches[0].clientX)},x=s=>{e.mouseDown&&(s.preventDefault(),e.newX=s.clientX||s.changedTouches[0].clientX)},S=()=>{e.mouseDown&&(e.mouseDown=!1,U())},L=(s=!1)=>{var t;if(e.loading&&!s)return;e.loading=!0,e.isCanSlide=!1;const u=H.value,f=z.value,p=F.value,a=u==null?void 0:u.getContext("2d"),v=f==null?void 0:f.getContext("2d"),y=p==null?void 0:p.getContext("2d");if(!a||!v||!y){console.error("not found ctx / ctx2 / ctx3");return}const $=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,g=document.createElement("img");if(a.fillStyle="rgba(255,255,255,1)",y.fillStyle="rgba(255,255,255,1)",a.clearRect(0,0,n.canvasWidth,n.canvasHeight),v.clearRect(0,0,n.canvasWidth,n.canvasHeight),e.pinX=o(r.value+20,n.canvasWidth-r.value-10),e.pinY=o(20,n.canvasHeight-r.value-10),g.crossOrigin="anonymous",g.onload=()=>{const[h,M,A,b]=Z(g);a.save(),T(a),a.closePath(),$?(a.clip(),a.save(),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=3,a.fill(),a.restore()):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=3,a.fill(),a.clip()),a.drawImage(g,h,M,A,b),y.fillRect(0,0,n.canvasWidth,n.canvasHeight),y.drawImage(g,h,M,A,b),a.globalCompositeOperation="source-atop",T(a),a.arc(e.pinX+Math.ceil(r.value/2),e.pinY+Math.ceil(r.value/2),r.value*1.2,0,Math.PI*2,!0),a.closePath(),a.shadowColor="rgba(255, 255, 255, .8)",a.shadowOffsetX=-1,a.shadowOffsetY=-1,a.shadowBlur=Math.min(Math.ceil(8*n.puzzleScale),12),a.fillStyle="#ffffaa",a.fill();const G=a.getImageData(e.pinX-3,e.pinY-20,e.pinX+r.value+5,e.pinY+r.value+5);v.putImageData(G,0,e.pinY-20),a.restore(),a.clearRect(0,0,n.canvasWidth,n.canvasHeight),a.save(),T(a),a.globalAlpha=.8,a.fillStyle="#ffffff",a.fill(),a.restore(),a.save(),a.globalCompositeOperation="source-atop",T(a),a.arc(e.pinX+Math.ceil(r.value/2),e.pinY+Math.ceil(r.value/2),r.value*1.2,0,Math.PI*2,!0),a.shadowColor="#000",a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=16,a.fill(),a.restore(),a.save(),a.globalCompositeOperation="destination-over",a.drawImage(g,h,M,A,b),a.restore(),e.loading=!1,e.isCanSlide=!0},g.onerror=()=>{L(!0)},!s&&((t=n.imgs)==null?void 0:t.length)){let h=o(0,n.imgs.length-1);h===e.imgIndex&&(h===n.imgs.length-1?h=0:h++),e.imgIndex=h,g.src=n.imgs[h]}else g.src=Q()},o=(s,t)=>Math.ceil(Math.random()*(t-s)+s),Z=s=>{const t=s.width/s.height,u=n.canvasWidth/n.canvasHeight;let f=0,p=0,a=0,v=0;return t>u?(v=n.canvasHeight,a=t*v,p=0,f=(n.canvasWidth-a)/2):(a=n.canvasWidth,v=a/t,f=0,p=(n.canvasHeight-v)/2),[f,p,a,v]},T=s=>{const t=Math.ceil(15*n.puzzleScale);s.beginPath(),s.moveTo(e.pinX,e.pinY),s.lineTo(e.pinX+t,e.pinY),s.arcTo(e.pinX+t,e.pinY-t/2,e.pinX+t+t/2,e.pinY-t/2,t/2),s.arcTo(e.pinX+t+t,e.pinY-t/2,e.pinX+t+t,e.pinY,t/2),s.lineTo(e.pinX+t+t+t,e.pinY),s.lineTo(e.pinX+t+t+t,e.pinY+t),s.arcTo(e.pinX+t+t+t+t/2,e.pinY+t,e.pinX+t+t+t+t/2,e.pinY+t+t/2,t/2),s.arcTo(e.pinX+t+t+t+t/2,e.pinY+t+t,e.pinX+t+t+t,e.pinY+t+t,t/2),s.lineTo(e.pinX+t+t+t,e.pinY+t+t+t),s.lineTo(e.pinX,e.pinY+t+t+t),s.lineTo(e.pinX,e.pinY+t+t),s.arcTo(e.pinX+t/2,e.pinY+t+t,e.pinX+t/2,e.pinY+t+t/2,t/2),s.arcTo(e.pinX+t/2,e.pinY+t,e.pinX,e.pinY+t,t/2),s.lineTo(e.pinX,e.pinY)},Q=()=>{const s=document.createElement("canvas"),t=s.getContext("2d");if(!t)return console.error("not found ctx"),"";s.width=n.canvasWidth,s.height=n.canvasHeight,t.fillStyle=`rgb(${o(100,255)},${o(100,255)},${o(100,255)})`,t.fillRect(0,0,n.canvasWidth,n.canvasHeight);for(let u=0;u<12;u++)if(t.fillStyle=`rgb(${o(100,255)},${o(100,255)},${o(100,255)})`,t.strokeStyle=`rgb(${o(100,255)},${o(100,255)},${o(100,255)})`,o(0,2)>1)t.save(),t.rotate(o(-90,90)*Math.PI/180),t.fillRect(o(-20,s.width-20),o(-20,s.height-20),o(10,s.width/2+10),o(10,s.height/2+10)),t.restore();else{t.beginPath();const f=o(-Math.PI,Math.PI);t.arc(o(0,s.width),o(0,s.height),o(10,s.height/2+10),f,f+Math.PI*1.5),t.closePath(),t.fill()}return s.toDataURL("image/png")},U=()=>{e.isSubmting=!0;const s=Math.abs(e.pinX-(X.value-d.value)+(r.value-d.value)*((X.value-d.value)/(n.canvasWidth-d.value))-3);s<n.range?(e.infoText=n.successText,e.infoBoxFail=!1,e.infoBoxShow=!0,e.isCanSlide=!1,e.isSuccess=!0,e.timer1&&clearTimeout(e.timer1),e.timer1=setTimeout(()=>{e.isSubmting=!1,Y("success",s)},800)):(e.infoText=n.failText,e.infoBoxFail=!0,e.infoBoxShow=!0,e.isCanSlide=!1,Y("fail",s),e.timer1&&clearTimeout(e.timer1),e.timer1=setTimeout(()=>{e.isSubmting=!1,C()},800))},J=()=>{e.infoBoxFail=!1,e.infoBoxShow=!1,e.isCanSlide=!1,e.isSuccess=!1,e.startWidth=d.value,e.startX=0,e.newX=0},C=()=>{e.isSubmting||(J(),L())};return(s,t)=>(_(),ee(te,{to:"body"},[i("div",{class:w(["vue-puzzle-vcode",{show_:c.show}]),onMousedown:I,onMouseup:k,onTouchstart:I,onTouchend:k},[i("div",{class:"vue-auth-box_",onMousedown:t[2]||(t[2]=E(()=>{},["stop"])),onTouchstart:t[3]||(t[3]=E(()=>{},["stop"]))},[i("div",{class:"auth-body_",style:m(`height: ${c.canvasHeight}px`)},[i("canvas",{ref_key:"canvas1",ref:H,width:c.canvasWidth,height:c.canvasHeight,style:m(`width:${c.canvasWidth}px;height:${c.canvasHeight}px`)},null,12,se),i("canvas",{ref_key:"canvas3",ref:F,class:w(["auth-canvas3_",{show:l(e).isSuccess}]),width:c.canvasWidth,height:c.canvasHeight,style:m(`width:${c.canvasWidth}px;height:${c.canvasHeight}px`)},null,14,ne),i("canvas",{ref_key:"canvas2",ref:z,class:"auth-canvas2_",width:l(r),height:c.canvasHeight,style:m(`width:${l(r)}px;height:${c.canvasHeight}px;transform:translateX(${l(X)-l(d)-(l(r)-l(d))*((l(X)-l(d))/(c.canvasWidth-l(d)))}px)`)},null,12,ie),i("div",{class:w(["loading-box_",{hide_:!l(e).loading}])},le,2),i("div",{class:w(["info-box_",{show:l(e).infoBoxShow},{fail:l(e).infoBoxFail}])},O(l(e).infoText),3),i("div",{class:w(["flash_",{show:l(e).isSuccess}]),style:m(`transform: translateX(${l(e).isSuccess?`${c.canvasWidth+c.canvasHeight*.578}px`:`-${c.canvasHeight*.578}px`}) skew(-30deg, 0);`)},null,6),i("img",{class:"reset_",onClick:C,src:ae})],4),i("div",ce,[i("div",{class:"range-box",style:m(`height:${l(d)}px`)},[i("div",re,O(c.sliderText),1),i("div",{class:"range-slider",ref_key:"rangeSlider",ref:W,style:m(`width:${l(X)}px`)},[i("div",{class:w(["range-btn",{isDown:l(e).mouseDown}]),style:m(`width:${l(d)}px`),onMousedown:t[0]||(t[0]=u=>R(u)),onTouchstart:t[1]||(t[1]=u=>R(u))},fe,38)],4)],4)])],32)],34)]))}});export{ge as _};
